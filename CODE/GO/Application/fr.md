---
title: 更快的文件删除
top: true
mathjax: false
date: 2023-08-15 13:07:34
tags:
categories:

file-created: 2023 11 15
last-modified: 2023 11 29
---

>[!note] 一句话概括
>最开始的我利用关闭动画来进行加速,后来的我使用多线程进行加速(结果还有bug),现在的我选择"silent",只要用户看不见删除,那就没有删除.





## 更快的文件删除

在日常使用电脑的过程中,当你想删除大量文件时.是不是总是会遇到,程序卡死,删除速度缓慢.

今天我们就尝试优化一下删除文件的操作.
### 分析原因

因为文件管理器不仅需要删除文件,还需要计算可能的花费时间,文件总数,文件总体大小,删除的进度,最后还需要绘制画面.

一个简单的删除操作,背后对应着多个任务,自然就会运行效率地下.

既然如此,我们不使用文件管理器,转而使用命令行不就好了.

## 设计实验
### tc

首先介绍我们第一个程序.它的作用就是显示我们执行某个命令所花费的时间,其自身的时间开销大概在10-20ms,足够我们正常使用了.


### td

用于产生测试数据.

### fr

我们的核心程序,将会进行删除操作. 


### 考核标准 

* 单文件夹十万文件 
* 100文件夹 1000文件 
* 100文件夹 100子文件夹 10文件 

每个人的电脑环境不一样,具体数据可能存在差异.

我们的del命令只能删除文件,删除文件夹还需要其他命令 也就是真实的时间花费应该还要再 加上删除文件夹的时间.

| 测试项目        | 单文件夹十万文件 (s) | 100文件夹 1000文件 (s) | 100文件夹 100子文件夹 10文件 (s) |
| --------------- | -------------------- | ---------------------- | -------------------------------- |
| 文件管理器      | 超时                 | 超时                   | 超时                             |
| del             | 46.367               | 51.515                 | 50.054                           |
| del  > nul      | 34.336               | 39.361                 | 38.987                           |
| fr              | 33.872               | 37.296                 | 45.673                           |
| fr multi-thread | 12.15                | 15.899                 | 19.789                           |

我们的fast remove 不仅实现了删除文件的同时删除文件夹,并且利用多线程,获得了比其他程序更强的性能,可以减少一半的时间开销.

经过测试,fastcopy的速度确实很快,比我的实现还要快一点点,只花费了9.73秒就完成了实验一. 不过我收获了一个速度还不错的多线程删除工具其实我自己还是很开心的. 

### 错误之处

在早期实现中,我的代码实现如下.
```

```


解决这个问题. 
我认为有三个前提. 
1. 文件的数量远远多于文件夹的数量,数量一般都会有一个数量级甚至更多的差别.
2. 删除文件夹的操作耗时很小,这里相对于删除大量文件操作. 
3. 上锁是不能采用的,首先是会将程序变得非常复杂,其次是会严重影响性能. 

最后我的解决方案是: 并发删除文件, 文件夹的删除交给单线程. 


## 总结

1. 移除其他程序的干扰
2. 不要在当前文件夹下删除文件
3. 不要使用文件管理器删除文件 而是使用命令行进行删除
4. 使用多线程来提升删除的速度
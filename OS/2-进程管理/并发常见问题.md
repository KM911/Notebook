### 信号量

#### 整型信号量

用一个整数型的变量作为信号量，用来表示系统中某种资源的数量。

如果一个进程无法访问临界区，那么就会出现进程一直占用处理器

#### 记录型信号量

用记录型数据结构表示的信号量

```c
typedef struct {
    int value;         //剩余资源数
    struct process *L; //等待队列 
} semaphore;

%% 某进程需要使用资源时,通过wait原语申请 %%
void wait (semaphore S){
    S.value--;
    if(S.value < 0){
        block ( S.L ) //如果剩余资源数不够，使用block 原语使进程从运行态进入阻塞态，并                        // 挂到信号量S的等待队列中
    }

}

void signal (semaphore S) {
    S.value++;
    if (S.value <= 0){
        wakeup( S.L )
    }
}

```

 P 操作为申请资源，V 操作为释放资源
 S.value 的初值表示系统中某种资源的数目

### 信号量实现进程同步

设置同步信号量 S，初始值为0

在先执行的操作之后执行 V(S)
在后执行的操作之后执行 P(S)

![[Pasted image 20231027100247.webp]]


### 生产者消费者问题


系统中有一组生产者进程和一组消费者进程，生产者进程每次生产一个产品放入缓冲区，消费者进程每次从缓冲区取出一个产品并使用。

生产者，消费者共享一个初始为空，大小为n的缓冲区
只有缓冲区没满时，生产者才能把产品防区缓冲区，否则必须等待。
只有缓冲区不空时，消费者才能从中取出产品，否则必须等待。

缓冲区是临界资源，各个进程必须互斥的访问。

实现互斥的  P 操作要在实现 同步的 P 操作之后，不然有可能发生死锁。









````col
```col-md
flexGrow=1
===
> [!note] 定义
> 编译器/硬件 调整指令的执行先后顺序, 以获得更高的性能. 


> [!tip] 相关概念
> [[CPU流水线]] [[CPU执行过程]]
```
```col-md
flexGrow=1
===
> [!cite]- 参考资料
> [编译器 - 每个程序员应知晓的编译器优化相关内容（第 2 部分） | Microsoft Learn](https://learn.microsoft.com/zh-cn/archive/msdn-magazine/2015/may/compilers-what-every-programmer-should-know-about-compiler-optimizations-part-2)

> [!error] 注意
> 指令重排可能会导致程序在多线程/并发的情况下出现问题
```
````

## 一个可能的例子? 


```c
int main(){
    FILE 
}
```

因为IO需要花费比较多的时间,编译器为了优化代码,可能会调整指令执行的先后顺序或者是中途插入其他指令,以此来提高性能. 

可以参考的文章 :


微软给出的例子有点奇怪,我不知道会不会成功. 
这里的 `t1` 将会移动到 `compute`前,导致记时功能失效. 

```c
#include <stdio.h>
#include <time.h>
__declspec(noinline) int compute(){
  /* Some code here */
  return 0;
}
int main() {
  time_t t0 = clock();
  /* Target location */
  int result = compute();
  time_t t1 = clock(); /* Function call to be moved */
  printf("Result (%d) computed in %lld ticks.", result, t1 - t0);
  return 0;
}
```
---
file-created: 星期六, 十一月 ,2023
last-modified: 星期日, 十一月 ,2023
---

## 前言
其实我已经写了不少程序了,比如图床上传工具,快捷方式管理等等,渐渐地也有了自己对于软件设计的理解.

## 软件流程


![[个人程序设计规范.canvas|个人程序设计规范]]



## 基于go语言的实践
### debug and release
在C/C++中,debug其实就是 -O0 ,release 就是 -O2,编译器会进行各种优化,比如常量展开,内联函数.其实这里的优化和我们的go是类似的,比如把符号表删除了,但是debug模式也并不debug,比如你无法知道该程序某个时刻,某个变量的值,又不能像gdb一样去查看,这样就比较麻烦.
我们利用debug 和 release 的条件编译选项,编写两个同名函数.
我们就可以在代码任意位置使用`Breakpoint`函数,当使用 go build -tags debug时就会打印信息,而release模式下编译器会将其优化掉,不会影响程序的运行和性能.
````col
```go
//go:build debug

package breakpoint

import "fmt"

func Breakpoint(a any) {
	fmt.Println(a)
}

```

```go
//go:build release

package breakpoint

func Breakpoint(a any) {

}

```
````
### 更优雅的错误处理

使用recover + panic 而不是 return err的理由: 
1. 减少函数返回值的传递 
2. 避免深层函数层层传递
3. 编写的代码将会更加简单 不必每一次操作要进行错误处理 而是将重心放到功能的实现上.
4. 将全部可能的错误进行统一处理 

我们后续编写代码只需要关心两点
1.使用 EmitError提交错误信息
2.在ErrorHandler中针对不同的错误信息进行错误处理


```go
func FileLogger(src string) {
	logFile, err := os.OpenFile(src, os.O_RDWR|os.O_CREATE|os.O_APPEND, 0766)
	if err != nil {
		panic(err)
	}
	log.SetOutput(logFile)
}

type ErrorMessage struct {
	Type int
	Msg  string
}

func EmitError(n int, msg string) {
	panic(ErrorMessage{
		Type: n,
		Msg:  msg,
	})
}

func Recover(errorHandler func(ErrorMessage)) {
	if errMsg := recover(); errMsg != nil {
		errorHandler(errMsg.(ErrorMessage))
		log.Println(errMsg.(ErrorMessage).Msg)
		log.Println(string(debug.Stack()))
	}
}

func ErrorHandler(err ErrorMessage) {
	switch err.Type {
	case 1:
		fmt.Println("Error type 1")
		fmt.Println(err.Msg)

	default:
		println("Unknown error type")
	}
}

func main() {
	FileLogger("test.log")
	defer Recover(ErrorHandler)
	CoreProcess()

}

func CoreProcess() {
	fmt.Println("core process")
	SubProcess()
}

func SubProcess() {
	EmitError(1, "test")
}
```

我们应该就是在debug模式下和release模式下进行不同的操作,非常简单. 

我们有两者错误,第一种就是被我预测的错误,就可以利用这个来,还有就是第二种错误,我无法预知的,严重错误. 是不是,或者说前者是我已经知道如何处理的错误,后者是


```
```
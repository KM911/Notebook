---
file-created: 星期五, 十一月 ,2023
last-modified: 星期日, 十一月 ,2023
---

>[!faq] 访问你的服务器时,需要等待很久? 图片等资源需要加载很久? 白屏时间非常长?

>[!done] 解决手段
>所有的解决xx不足的问题,都可以从开源和节流两个角度去解决. 
>>[!done] 开源
>>1.[[网络优化#CDN|CDN]]   让资源服务器来处理请求
>>2.[[网络优化#OSS Object Storage Service|OSS]] 用存储服务来处理请求
>
>>[!done] 节流
> 1.[[网络优化#数据压缩|数据压缩]] 减少请求的数据包大小
> 2.本地缓存 减少请求频率和次数

说升级带宽这种说法会不会被打,但是我不太喜欢这种回答问题的方式. 


## CDN

>[!note] 简单来讲就是你交钱给ISP(Internet Service Provider),他们用的的服务器来帮你分发资源. 

我主要是想说明一下为什么可以提高速度.  

1. 缩短网络链路
你的服务器在美国,我在湖北访问,物理条件限制了访问速度.现在你把html等静态文件放到了上海的服务器上,即使只考虑物理距离,速度都会有所提升,并且该请求并不需要到底你的服务器. 
2. 减轻网络干路压力
就如图马路会堵车一样,网络也会因为传输能力不足发送拥堵.假如出海链路发生拥堵,肯定会影响性能的. 从这个角度来看,我们甚至就应该购买ISP的CDN服务,因为它可以减少
3. 服务器压力减轻
因为请求根本就没有到你的服务器,你的服务器根本就不用处理请求,即使再多的请求数量,也不会因为服务性能瓶颈而降低访问速度. 


## OSS  Object Storage Service 

其实本质和CDN是一样的,不过OSS通常针对视频图片等"大文件". 

因为也不需要去访问你的服务器了,自然可以提高速度. 

## 数据压缩

>[!note] [[压缩文件]]
>对于文本文件,尤其是html这种存在大量重复内容的文件,可以采取一定的压缩操作,减少文件体积,在网络传输时减轻网络带宽的压力.

一般我们会将静态文件交给nginx处理,让它来帮助我们做压缩操作. [[PROJECT/SCHEME/nginx#GZip Br|nginx 开启数据压缩]].


>[!warning] 一体两面 
>使用了压缩确实可以减少文件的体积,减少网络资源消耗,但是服务端需要进行压缩操作,客户端也需要对其进行解压,会增加CPU的占用;此外客户端因为解压的操作,开发难度会有所提高. 不过总体上来,使用压缩还是好处大于坏处的. 个人认为,在99%的情况下,网络带宽才是性能瓶颈,所以尽可能地压缩数据吧.  

在浏览器环境下,主流浏览器会在请求时带上 [[Header#Accept-Encoding|Accept-Encoding]] 这个header说明其支持的类型,通常是 `gzip` `deflate` `br` . 

GNU tar 使用gzip压缩默认9级，nginx为1级。


不同级别的gzip压缩何处存在差异?
阅读 [zip - How do the different compression levels of gzip differ? - Stack Overflow](https://stackoverflow.com/questions/44895609/how-do-the-different-compression-levels-of-gzip-differ)


### 测试代码

[[压缩测试用代码#测试gzip|点击跳转查看]]

### gzip 可视化
![[Pasted image 20231124153238.webp]]
![[Pasted image 20231124153251.webp]]








## Local Storage 

这里的local storage 是浏览器提供的本地存储服务也是一种思想.

>[!exp] 不是所有文件都会频发更新 
>既然很多文件比如网站图标,字体等资源,更新频率很低,我们完全只需要请求一次,日后都使用本地的缓存就好了. 

浏览器提供了Local Storage,请求头中可以设置过期时间 [[Header#Expires]] 来设置资源的过期时间,如果还是访问该资源就直接使用本地的缓存. 


强制缓存 

协商缓存 

